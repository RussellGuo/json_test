#include <string.h>
#include <stdio.h>
#include "mhscpu.h"
#include "mh_sha.h"
#include "crypt_debug.h"

void SHA_Test()
{
    uint16_t  t;
    MHSHA1_Context ctx;
    MHSHA256_Context ctx2;
    MHSHA512_Context ctx512;

    uint8_t digest[32] = {0};
    uint8_t digest1[32] = {0};
    
    uint32_t digLen = 0;
        
    uint8_t c_msg_32[] = {
        0x01, 0x02, 0x03,0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x10, 
        0x01, 0x02, 0x03,0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x10};
        
    uint8_t c_len32_sha1_hash[] = {0x73, 0x38, 0xE1, 0x41, 0x87, 0xA4, 0x7E, 0xA6, 0xA2, 0x62, 0xBF, 0xC4, 0xAA, 0xD7, 0x4B, 0x7F, 0xE8, 0x67, 0xE8, 0x1E};
    uint8_t c_len32_sha224_hash[] = {
        0xCC, 0xA2, 0x9B, 0x7D, 0xAd, 0xBE, 0xBA, 0xE3, 0xFF, 0x52, 0x04, 0x77, 0xB6, 0xC2, 0xAC, 0x21, 0x4A, 0xF4, 0xC0, 0x1D, 
        0x4A, 0x51, 0x76, 0xD2, 0x8D, 0x31, 0x26, 0x03};
    uint8_t c_len32_sha256_hash[] = {
        0x48, 0x9E, 0x98, 0xC8, 0x89, 0xE3, 0x54, 0x96, 0xDB, 0x0D, 0xD5, 0x13, 0x73, 0x4F, 0x69, 0xF5, 0x98, 0xE4, 0x66, 0x83, 
        0x13, 0xFC, 0x7C, 0x20, 0xC5, 0x9C, 0x0D, 0x89, 0x00, 0xEE, 0x1F, 0x2B};
    uint8_t c_len32_sha384_hash[] = {
        0x97, 0x35, 0x8A, 0xD1, 0x3F, 0x29, 0x64, 0xAD, 0x09, 0x31, 0x7A, 0x85, 0xE0, 0xE7, 0xB6, 0x48, 0xE3, 0x09, 0x66, 0xA2, 
        0x5F, 0x0D, 0x59, 0xFA, 0x7F, 0x28, 0x10, 0xE4, 0xFD, 0x76, 0x06, 0xA5, 0xD1, 0xAE, 0x4F, 0xEC, 0xCC, 0x3E, 0x0E, 0xB0, 
        0xE5, 0xB7, 0x04, 0x2B, 0x1C, 0xEC, 0xE6, 0xCD};
    uint8_t c_len32_sha512_hash[] = {
        0xAF, 0xF5, 0xCD, 0xBD, 0x4D, 0xC8, 0x47, 0x19, 0x17, 0xE7, 0xDD, 0x15, 0x78, 0x80, 0x2E, 0xA7, 0xA7, 0x35, 0x92, 0xAA, 
        0x66, 0xD7, 0x70, 0x11, 0xA0, 0x4A, 0x63, 0xB5, 0x37, 0xD9, 0x8E, 0x4D, 0x2C, 0x84, 0xC8, 0x90, 0xDE, 0x81, 0x62, 0x96, 
        0x6A, 0xD3, 0xE2, 0x76, 0x23, 0x1D, 0x02, 0x91, 0x3B, 0x2A, 0xA9, 0xA1, 0xAB, 0x01, 0x34, 0x3D, 0x8F, 0x78, 0x33, 0xA7, 
        0xA1, 0x07, 0xF3, 0x06};
    
    uint8_t c_UpdateSha512Hash[] = {
        0xC7, 0xD1, 0x69, 0x46, 0xC9, 0x1E, 0xA1, 0xD7, 0x38, 0xAE, 0xBB, 0x65, 0x9E, 0xF1, 0xCF, 0x2D, 0xDD, 0x83, 0x6E, 0x1C, 
        0xBE, 0xE4, 0x18, 0xDE, 0x24, 0xDA, 0x0D, 0x27, 0x86, 0xB7, 0x6C, 0xA9, 0x76, 0xBB, 0x81, 0xF1, 0x7F, 0xC9, 0x94, 0x8C, 
        0xA0, 0x12, 0x0B, 0x92, 0xFA, 0x2D, 0x04, 0x21, 0x19, 0x27, 0xC7, 0xBF, 0x2A, 0xA1, 0xBA, 0x77, 0xD0, 0x7F, 0x2F, 0x82, 
        0x6E, 0xCC, 0x9B, 0xA2};
    DBG_PRINT("Test the sha function...\r\n");
       
    //SHA160
    memset(digest,0,sizeof(digest));
    MHSHA_Sha(MHSHA1, c_msg_32, sizeof(c_msg_32), digest, 20);
    ouputRes("SH160: ", digest, sizeof(c_len32_sha1_hash));
    r_printf((!memcmp(c_len32_sha1_hash, digest, sizeof(c_len32_sha1_hash))), "SH160 Test\n");
   
    //SHA224
    memset(digest,0,sizeof(digest));
    MHSHA_Sha(MHSHA224, c_msg_32, sizeof(c_msg_32), digest, 28);
    ouputRes("SH224: ", digest, sizeof(c_len32_sha224_hash));
    r_printf((!memcmp(c_len32_sha224_hash, digest, sizeof(c_len32_sha224_hash))), "SH224 Test\n");
    
    //SHA256
    memset(digest1,0,sizeof(digest1));
    MHSHA_Sha(MHSHA256, c_msg_32, sizeof(c_msg_32), digest, 32);
    ouputRes("SH256: ", digest, sizeof(c_len32_sha256_hash));
    r_printf((!memcmp(c_len32_sha256_hash, digest, sizeof(c_len32_sha256_hash))), "SH256 Test\n");

    //SHA384
    memset(digest,0,sizeof(digest));
    MHSHA_Sha(MHSHA384, c_msg_32, sizeof(c_msg_32), digest, 48);
    ouputRes("SHA384: ", digest, sizeof(c_len32_sha384_hash));
    r_printf((!memcmp(c_len32_sha384_hash, digest, sizeof(c_len32_sha384_hash))), "SHA384 Test\n");

    //SHA512
    memset(digest,0,sizeof(digest));
    MHSHA_Sha(MHSHA512, c_msg_32, sizeof(c_msg_32), digest, 64);
    ouputRes("SHA512: ", digest, sizeof(c_len32_sha512_hash));
    r_printf((!memcmp(c_len32_sha512_hash, digest, sizeof(c_len32_sha512_hash))), "SHA512 Test\n");


    //Start//Update....//Finish
    memset(digest,0,sizeof(digest));
    MHSHA1_Starts(&ctx);
    MHSHA1_Update(&ctx,c_msg_32, sizeof(c_msg_32));
    MHSHA1_Finish(&ctx,digest);
    ouputRes("SHA160: ", digest, sizeof(c_len32_sha1_hash));
    r_printf((!memcmp(c_len32_sha1_hash, digest, sizeof(c_len32_sha1_hash))), "SH160 Update Test\n");	 

    memset(digest,0,sizeof(digest));
    MHSHA256_Starts(&ctx2);
    MHSHA256_Update(&ctx2,c_msg_32, sizeof(c_msg_32));
    MHSHA256_Finish(&ctx2,digest);
    ouputRes("SHA256: ", digest, sizeof(c_len32_sha256_hash));
    r_printf((!memcmp(c_len32_sha256_hash, digest, sizeof(c_len32_sha256_hash))), "SH256 Update Test\n");	
    
   
    memset(digest,0,sizeof(digest));
    MHSHA512_Starts(&ctx512);
    MHSHA512_Update(&ctx512,c_msg_32, sizeof(c_msg_32));
    MHSHA512_Update(&ctx512,c_msg_32, sizeof(c_msg_32));
    MHSHA512_Update(&ctx512,c_msg_32, sizeof(c_msg_32));
    MHSHA512_Update(&ctx512,c_msg_32, sizeof(c_msg_32));
    MHSHA512_Finish(&ctx512,digest);
    ouputRes("SHA512: ", digest, sizeof(c_UpdateSha512Hash));
    r_printf((!memcmp(c_UpdateSha512Hash, digest, sizeof(c_UpdateSha512Hash))), "SH512 Update Test\n");   
    
    memset(digest,0,sizeof(digest));
    MHSHA256_Starts(&ctx2);
    MHSHA256_Update(&ctx2,(uint8_t *)(MHSCPU_FLASH_BASE + 16*1024), 4*1024);
    MHSHA256_Update(&ctx2,(uint8_t *)(MHSCPU_FLASH_BASE + 20*1024), 4*1024);
    MHSHA256_Finish(&ctx2,digest);

    ouputRes("SHA256 Multi_Update: ", digest, sizeof(c_len32_sha256_hash));        
}

